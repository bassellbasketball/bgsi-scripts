TRICK_OR_TREAT = true
DELAY = 0.5
AUTO_HATCH_EGG = false
EVERY_NUMBER_HOUSE = 10
AUTO_HATCH_DELAY = 1

AUTO_BUY_SPOOKY_ALL = false
AUTO_SPIN_WHEEL = false
BUY_CURRENCY_UPGRADE = true
BUY_LUCK_UPGRADE = false
BUY_SECRET_LUCK_UPGRADE = false
BUY_INFINITY_LUCK_UPGRADE = false
BUY_HALLOWEEN_SHOP_SLOT = false
AUTO_BUY_HALLOWEEN_ALL = false

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local rsShared = ReplicatedStorage:WaitForChild("Shared")
local framework = rsShared:WaitForChild("Framework")
local network = framework:WaitForChild("Network")
local remoteFolder = network:WaitForChild("Remote")
local remoteEvent = remoteFolder:WaitForChild("RemoteEvent")
local remoteFunction = remoteFolder:WaitForChild("RemoteFunction")

local function safeFire(a,b,c,d)
    pcall(function()
        remoteEvent:FireServer(a,b,c,d)
    end)
end

local function safeInvoke(a,b,c,d)
    local ok,res = pcall(function()
        return remoteFunction:InvokeServer(a,b,c,d)
    end)
    if ok then return res end
end

task.spawn(function()
    while AUTO_SPIN_WHEEL do
        safeInvoke("HalloweenWheelSpin")
        task.wait(0.1)
        safeFire("ClaimHalloweenWheelSpinQueue")
        task.wait(6)
    end
end)

task.spawn(function()
    while AUTO_BUY_SPOOKY_ALL do
        for i = 1, 3 do
            safeFire("BuyShopItem", "spooky-shop", i, true)
            task.wait(60)
        end
    end
end)

task.spawn(function()
    while true do
        if BUY_CURRENCY_UPGRADE then safeFire("BuyHalloweenUpgrade", "Currency") end
        if BUY_LUCK_UPGRADE then safeFire("BuyHalloweenUpgrade", "Luck") end
        if BUY_SECRET_LUCK_UPGRADE then safeFire("BuyHalloweenUpgrade", "SecretLuck") end
        if BUY_INFINITY_LUCK_UPGRADE then safeFire("BuyHalloweenUpgrade", "InfinityLuck") end
        task.wait(60)
    end
end)

task.spawn(function()
    while AUTO_BUY_HALLOWEEN_ALL do
        for i = 1, 9 do
            safeFire("BuyShopItem", "halloween-shop", i, false)
            task.wait(120)
        end
    end
end)

if TRICK_OR_TREAT then
    local player = Players.LocalPlayer
    local hrp
    if player.Character then
        hrp = player.Character:WaitForChild("HumanoidRootPart")
    else
        player.CharacterAdded:Wait()
        hrp = player.Character:WaitForChild("HumanoidRootPart")
    end

    local locations = {
        Vector3.new(-5033.50, 22.37, -619.40),
        Vector3.new(-5052.92, 22.37, -596.65),
        Vector3.new(-5036.97, 25.16, -550.20),
        Vector3.new(-5058.79, 25.16, -555.47),
        Vector3.new(-5079.90, 22.31, -686.93),
        Vector3.new(-5053.41, 22.31, -698.50),
        Vector3.new(-4984.23, 16.32, -685.97),
        Vector3.new(-4962.21, 16.32, -692.00),
        Vector3.new(-4888.24, 21.87, -489.50),
        Vector3.new(-4890.34, 21.87, -468.01),
        Vector3.new(-4935.93, 19.08, -452.81),
        Vector3.new(-4964.18, 19.08, -460.37)
    }

    local used = {}
    local houseCount = 0

    local function teleportAndMove()
        if #used >= #locations then
            used = {}
        end
        local index
        repeat
            index = math.random(1, #locations)
        until not table.find(used, index)
        table.insert(used, index)
        hrp.CFrame = CFrame.new(locations[index])
        task.wait(0.05)
        hrp.CFrame = hrp.CFrame * CFrame.new(0, -4, 0)
        task.wait(0.05)
        hrp.CFrame = hrp.CFrame * CFrame.new(0, 5, 0)
    end

    local function autoHatch()
        local VirtualInputManager = game:GetService("VirtualInputManager")
        if not Players.LocalPlayer.Character then Players.LocalPlayer.CharacterAdded:Wait() end
        Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(-4929.70654296875, 26.532316207885742, -546.8717651367188)
        local ok, hatchModule = pcall(function() return ReplicatedStorage.Client.Effects.HatchEgg end)
        if ok and hatchModule then
            pcall(function() require(ReplicatedStorage.Client.Effects.HatchEgg).Play = function() return end end)
        end
        local t = tick()
        while tick() - t < AUTO_HATCH_DELAY do
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
            task.wait(0.05)
        end
    end

    task.spawn(function()
        while TRICK_OR_TREAT do
            teleportAndMove()
            houseCount = houseCount + 1
            if AUTO_HATCH_EGG and houseCount >= EVERY_NUMBER_HOUSE then
                autoHatch()
                houseCount = 0
            end
            task.wait(DELAY)
        end
    end)
end
